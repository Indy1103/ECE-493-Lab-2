# Data Model: User Account Registration

## Entity: RegistrationSubmission

Purpose: Input payload submitted by an unauthenticated user to request account creation.

Fields:
- `fullName` (string, required, non-empty)
- `email` (string, required, valid email format)
- `password` (string, required)
- `submittedAt` (timestamp, generated by system)

Validation rules:
- `fullName` must contain visible characters after trimming.
- `email` must be syntactically valid and normalized for uniqueness checks (`trim` + lowercase).
- `password` must be at least 8 characters and include at least one letter and one number.

State transitions (request lifecycle):
- `RECEIVED` -> `VALIDATION_FAILED` (invalid/incomplete input)
- `RECEIVED` -> `DUPLICATE_EMAIL` (email already registered)
- `RECEIVED` -> `THROTTLED` (client exceeds failed-attempt threshold)
- `RECEIVED` -> `REGISTERED` (account created successfully)
- `RECEIVED` -> `PROCESSING_FAILURE` (operational failure)

## Entity: UserAccount

Purpose: Persisted identity record enabling authenticated access to CMS features.

Fields:
- `id` (UUID, primary key, immutable)
- `full_name` (string, required)
- `email_original` (string, required)
- `email_normalized` (string, required, unique)
- `password_hash` (string, required)
- `role` (enum, required, default `REGISTERED_USER`)
- `status` (enum, required, default `ACTIVE`)
- `created_at` (timestamp with timezone, required)
- `updated_at` (timestamp with timezone, required)

Validation rules:
- `email_normalized` uniqueness must be enforced at persistence boundary.
- `password_hash` must be generated from a vetted hashing algorithm and never store plaintext.
- Newly created account must default to non-privileged role and active login-eligible status.

State transitions:
- `PENDING_CREATION` -> `ACTIVE` (successful registration)
- `PENDING_CREATION` -> `NOT_CREATED` (validation/duplicate/throttled/processing failure)

## Entity: RegistrationThrottleRecord

Purpose: Tracks failed registration attempts for a client identity window to enforce temporary throttling.

Fields:
- `client_key` (string, required; derived client identity key)
- `window_start` (timestamp, required)
- `failed_attempt_count` (integer, required)
- `blocked_until` (timestamp, nullable)

Validation rules:
- If `failed_attempt_count >= 5` within 10 minutes, set `blocked_until` to 10 minutes ahead of threshold breach.
- While current time < `blocked_until`, registration submissions from the same client key must return throttled outcome.

## Entity: RegistrationOutcome

Purpose: Deterministic user-visible registration result.

Values:
- `REGISTERED`
- `VALIDATION_FAILED`
- `DUPLICATE_EMAIL`
- `THROTTLED`
- `PROCESSING_FAILURE`

Rules:
- Exactly one outcome is emitted per submission.
- `REGISTERED` is the only outcome that creates a `UserAccount`.
- Non-success outcomes must include explicit user-facing messaging.

## Relationships

- One `RegistrationSubmission` produces exactly one `RegistrationOutcome`.
- A successful `RegistrationSubmission` creates one `UserAccount`.
- `RegistrationThrottleRecord` governs many `RegistrationSubmission` attempts sharing the same `client_key`.
